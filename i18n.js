// ======= i18n.js =======
window.I18N = {
  ar: {
    app_title: "Ù…ØµØ§Ø±ÙŠÙÙŠ | My Expenses",
    add_expense: "Ø¥Ø¶Ø§ÙØ© Ù…ØµØ±ÙˆÙ",
    name: "Ø§Ù„Ø§Ø³Ù…/Ø§Ù„ÙˆØµÙ",
    amount: "Ø§Ù„Ù…Ø¨Ù„Øº",
    category: "Ø§Ù„ØªØµÙ†ÙŠÙ",
    date: "Ø§Ù„ØªØ§Ø±ÙŠØ®",
    note_optional: "Ù…Ù„Ø§Ø­Ø¸Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)",
    save: "Ø­ÙØ¸",
    expenses: "Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ",
    actions: "Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª",
    delete: "Ø­Ø°Ù",
    edit: "ØªØ¹Ø¯ÙŠÙ„",
    total_today: "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙŠÙˆÙ…",
    total_month: "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø´Ù‡Ø±",
    remaining_budget: "Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ù…Ù† Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©",
    set_budget: "ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø§Ù„Ø´Ù‡Ø±ÙŠØ©",
    filters: "Ø¨Ø­Ø«/ØªØµÙÙŠØ©",
    filter_category: "ØªØµÙ†ÙŠÙ",
    filter_date_from: "Ù…Ù† ØªØ§Ø±ÙŠØ®",
    filter_date_to: "Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®",
    apply_filters: "ØªØ·Ø¨ÙŠÙ‚",
    reset_filters: "Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†",
    export_csv: "ØªØµØ¯ÙŠØ± CSV",
    reset_data: "Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª",
    confirm_reset: "Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ",
    language: "Ø§Ù„Ù„ØºØ©",
    install_app: "ðŸ“² Ø«Ø¨Ù‘Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚",
    privacy: "Ø§Ù„Ø®ØµÙˆØµÙŠØ©",
    banner_top: "Ø¨Ù†Ø± Ø£Ø¹Ù„Ù‰",
    banner_bottom: "Ø¨Ù†Ø± Ø£Ø³ÙÙ„",
    toggle_banners: "Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¨Ù†Ø±Ø§Øª",
    highest_category: "Ø£Ø¹Ù„Ù‰ ØªØµÙ†ÙŠÙ Ø¥Ù†ÙØ§Ù‚",
    charts: "Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ©",
    pie_title: "ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø¨Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª",
    bar_title: "Ø§Ù„Ø¥Ù†ÙØ§Ù‚ Ø§Ù„ÙŠÙˆÙ…ÙŠ",
    toast_added: "ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©",
    toast_updated: "ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«",
    toast_deleted: "ØªÙ… Ø§Ù„Ø­Ø°Ù",
    toast_exported: "ØªÙ… ØªÙ†Ø²ÙŠÙ„ CSV",
    toast_settings_saved: "ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª",
    budget_placeholder: "Ù…Ø«Ø§Ù„: 3000",
    lang_toggle: "EN",
  },
  en: {
    app_title: "Masarefy | My Expenses",
    add_expense: "Add Expense",
    name: "Name/Description",
    amount: "Amount",
    category: "Category",
    date: "Date",
    note_optional: "Note (optional)",
    save: "Save",
    expenses: "Expenses",
    actions: "Actions",
    delete: "Delete",
    edit: "Edit",
    total_today: "Total Today",
    total_month: "Total This Month",
    remaining_budget: "Remaining Budget",
    set_budget: "Monthly Budget",
    filters: "Search/Filter",
    filter_category: "Category",
    filter_date_from: "From",
    filter_date_to: "To",
    apply_filters: "Apply",
    reset_filters: "Reset",
    export_csv: "Export CSV",
    reset_data: "Clear Data",
    confirm_reset: "Are you sure you want to clear all local data?",
    language: "Language",
    install_app: "ðŸ“² Add to Home Screen",
    privacy: "Privacy",
    banner_top: "Top Banner",
    banner_bottom: "Bottom Banner",
    toggle_banners: "Toggle Banners",
    highest_category: "Top Spending Category",
    charts: "Charts",
    pie_title: "Spending by Category",
    bar_title: "Daily Spending",
    toast_added: "Added",
    toast_updated: "Updated",
    toast_deleted: "Deleted",
    toast_exported: "CSV downloaded",
    toast_settings_saved: "Settings saved",
    budget_placeholder: "e.g., 3000",
    lang_toggle: "Ø¹",
  }
};

window.I18nState = { lang: 'ar' };

function detectLanguage(){
  const pref = (localStorage.getItem('lang') || window.APP_CONFIG.DEFAULT_LANGUAGE || 'auto');
  if (pref !== 'auto') return pref;
  const nav = (navigator.language||'').toLowerCase();
  return nav.startsWith('ar') ? 'ar' : 'en';
}

function applyLanguage(lang){
  window.I18nState.lang = lang;
  localStorage.setItem('lang', lang);
  const dict = window.I18N[lang];
  document.documentElement.lang = lang;
  document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
  document.querySelectorAll('[data-i18n]').forEach(el=>{
    const key = el.getAttribute('data-i18n');
    if(dict[key]) el.textContent = dict[key];
  });
  document.querySelectorAll('[data-i18n-ph]').forEach(el=>{
    const key = el.getAttribute('data-i18n-ph');
    if(dict[key]) el.setAttribute('placeholder', dict[key]);
  });
}

function toggleLanguage(){
  const lang = window.I18nState.lang === 'ar' ? 'en' : 'ar';
  applyLanguage(lang);
  if(typeof window.renderCharts === 'function'){ window.renderCharts(); }
}

window.addEventListener('DOMContentLoaded', ()=>{
  const lang = detectLanguage();
  applyLanguage(lang);
});
