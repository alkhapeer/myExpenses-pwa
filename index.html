<!doctype html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#0ea5e9">
    <title>My Expenses</title>
    <link rel="manifest" href="./manifest.webmanifest">
    <link rel="apple-touch-icon" href="./icon-192.png">
    <link rel="icon" sizes="192x192" href="./icon-192.png">
    <link rel="icon" sizes="512x512" href="./icon-512.png">
    <link rel="stylesheet" href="./styles.css">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js" defer></script>
    <!-- App -->
    <script type="module" src="./app.js" defer></script>
    <script type="module">
      import { wireInstallButton } from "./install.js";
      window.addEventListener("DOMContentLoaded", wireInstallButton);
    </script>
    <script type="module" src="./service-worker-register.js" defer></script>
  </head>
  <body>
    <div class="container">
      <h1 id="appTitle">مصروفاتي</h1>
      <div class="topbar">
        <button id="openSettings" class="secondary" type="button" data-i18n="settings">الإعدادات</button>
      </div>

      <div class="grid">
        <div class="card">
          <form id="expenseForm" class="grid grid-2">
            <div>
              <label id="labelDate" data-i18n="date">التاريخ</label>
              <input type="date" id="date" name="date" required>
            </div>
            <div>
              <label id="labelCategory" data-i18n="category">التصنيف</label>
              <input type="text" id="category" name="category" data-i18n-placeholder="category" placeholder="التصنيف" required>
            </div>
            <div>
              <label id="labelDesc" data-i18n="description">الوصف</label>
              <input type="text" id="description" name="description" data-i18n-placeholder="description" placeholder="الوصف">
            </div>
            <div>
              <label id="labelAmount" data-i18n="amount">المبلغ</label>
              <input type="number" step="0.01" id="amount" name="amount" required>
            </div>
            <div>
              <button class="primary" id="submitBtn" type="submit">
                <span id="submitBtnLabel" data-i18n="add_expense">إضافة مصروف</span>
              </button>
            </div>
            <div>
              <button class="secondary hidden" id="cancelEdit" type="button" data-i18n="cancel_edit">إلغاء</button>
            </div>
          </form>
        </div>

        <div class="card">
          <h2 data-i18n="filter">تصفية</h2>
          <div class="grid grid-2">
            <input id="q" type="search" data-i18n-placeholder="search" placeholder="بحث">
            <div>
              <label data-i18n="from">من</label>
              <input id="from" type="date">
            </div>
            <div>
              <label data-i18n="to">إلى</label>
              <input id="to" type="date">
            </div>
            <button id="clearFilters" class="secondary" type="button" data-i18n="clear_filters">مسح المرشحات</button>
          </div>
        </div>

        <div class="card">
          <table class="table">
            <thead>
              <tr>
                <th data-i18n="date">التاريخ</th>
                <th data-i18n="category">التصنيف</th>
                <th data-i18n="description">الوصف</th>
                <th data-i18n="amount">المبلغ</th>
                <th id="thActions" data-i18n="actions">إجراءات</th>
              </tr>
            </thead>
            <tbody id="tbody"></tbody>
          </table>
        </div>

        <div class="card summary">
          <div class="item">
            <div class="small" data-i18n="total_today">إجمالي اليوم</div>
            <div id="sumToday">0</div>
          </div>
          <div class="item">
            <div class="small" data-i18n="total_month">إجمالي الشهر</div>
            <div id="sumMonth">0</div>
          </div>
          <div class="item">
            <div class="small" data-i18n="top_category">أكثر تصنيف</div>
            <div id="sumTopCat">—</div>
          </div>
        </div>

        <div class="card"><canvas id="pieChart" height="120"></canvas></div>
        <div class="card"><canvas id="barChart" height="120"></canvas></div>

        <div class="card">
          <div class="footer">
            <button id="resetAll" class="danger" type="button" data-i18n="reset_all">إعادة التعيين (مسح الكل)</button>
            <button id="btnInstall" class="primary" type="button" data-i18n="install_app" data-installed-text="Installed" disabled>تثبيت التطبيق</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal hidden" aria-hidden="true">
      <div class="modal-backdrop"></div>
      <div class="modal-dialog card">
        <div class="modal-header">
          <h2 data-i18n="settings">الإعدادات</h2>
          <button id="closeSettings" class="btn" type="button">×</button>
        </div>
        <div class="grid grid-2">
          <div>
            <label data-i18n="language">اللغة</label>
            <select id="langSelect">
              <option value="ar">العربية</option>
              <option value="en">English</option>
            </select>
          </div>
          <div>
            <label data-i18n="currency">العملة</label>
            <input id="currencyInput" type="text" maxlength="4" value="﷼">
          </div>
          <div>
            <label data-i18n="budget">الميزانية</label>
            <input id="budgetInput" type="number" step="0.01">
          </div>
          <div>
            <button id="saveSettings" class="primary" type="button" data-i18n="save">حفظ</button>
          </div>
        </div>
      </div>
    </div>

    <script type="module">
      import { applyLang, getInitialLang } from "./i18n.js";
      applyLang(localStorage.getItem("lang") || getInitialLang());
    </script>
  </body>
</html>
